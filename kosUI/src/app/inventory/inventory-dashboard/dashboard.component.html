<div class="app-layout">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="logo">
      <div class="logo-box">K</div>
      <span>KOS</span>
    </div>

    <div class="nav">

      <a class="active">
        <mat-icon>dashboard</mat-icon>
        <span>Dashboard</span>
      </a>

      <a>
        <mat-icon>inventory</mat-icon>
        <span>Manage Inventory</span>
      </a>

      <a>
        <mat-icon>restaurant_menu</mat-icon>
        <span>Menu</span>
      </a>

      <a>
        <mat-icon>shopping_cart</mat-icon>
        <span>Orders</span>
      </a>

      <a>
        <mat-icon>qr_code</mat-icon>
        <span>QR Codes</span>
      </a>

      <a>
        <mat-icon>settings</mat-icon>
        <span>Settings</span>
      </a>

    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="dashboard-container">

    <!-- Toolbar -->
    <div class="toolbar">

      <div class="page-title">
        <h2>Inventory Dashboard</h2>
        <span class="subtitle">Real-time kitchen performance overview</span>

        <div class="last-refresh">
          Last Updated: {{ lastUpdated | date:'shortTime' }}
        </div>
      </div>

      <div class="toolbar-actions">

        <mat-form-field appearance="outline">
          <mat-label>Date Range</mat-label>
          <mat-select [(ngModel)]="filter.dateRange"
                      (selectionChange)="loadDashboardData()">
            <mat-option *ngFor="let d of dateRanges" [value]="d.value">
              {{ d.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select [(ngModel)]="filter.category"
                      (selectionChange)="loadDashboardData()">
            <mat-option *ngFor="let c of categoriesList" [value]="c.value">
              {{ c.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-stroked-button (click)="refresh()">
          <mat-icon>refresh</mat-icon>
          Refresh
        </button>

        <button mat-stroked-button (click)="toggleAutoRefresh()">
          <mat-icon>{{ autoRefresh ? 'pause' : 'autorenew' }}</mat-icon>
          {{ autoRefresh ? 'Stop Auto' : 'Auto Refresh' }}
        </button>

        <button mat-raised-button color="primary" (click)="exportToCSV()">
          <mat-icon>download</mat-icon>
          Export
        </button>

      </div>
    </div>

    <!-- KPI Section -->
    <div class="kpi-section">

      <mat-card class="kpi-card hover-card"
                *ngFor="let s of stats">

        <div class="kpi-strip" [style.background]="s.color"></div>

        <mat-card-content>

          <div class="kpi-top">

            <div class="kpi-icon" [style.background]="s.color">
              <mat-icon>{{ s.icon }}</mat-icon>
            </div>

            <div class="kpi-trend"
                 [ngClass]="{
                    'trend-up': s.trend === 'up',
                    'trend-down': s.trend === 'down'
                 }">

              <mat-icon>
                {{ s.trend === 'up' ? 'arrow_upward' :
                   s.trend === 'down' ? 'arrow_downward' :
                   'trending_flat' }}
              </mat-icon>

              {{ s.trendText }}

            </div>

          </div>

          <div class="kpi-title">{{ s.title }}</div>

          <div class="kpi-value">{{ s.value }}</div>

          <div class="kpi-sub">{{ s.sub }}</div>

        </mat-card-content>

      </mat-card>

    </div>

    <!-- MAIN GRID -->
    <div class="dashboard-grid">

      <!-- TOP SELLING ITEMS (SEARCH REMOVED AS REQUESTED) -->
      <mat-card>

        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            Top Selling Items
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>

          <div class="top-selling-container">

            <div *ngIf="filteredTopSelling().length === 0"
                 class="empty-state-small">
              No matching items found
            </div>

            <div class="top-item-card"
                 *ngFor="let item of filteredTopSelling(); let i = index">

              <div class="rank-badge">
                #{{ i + 1 }}
              </div>

              <div class="popular-badge" *ngIf="i === 0">
                ðŸ”¥ Most Popular
              </div>

              <div>
                <img [src]="item.image"
                     class="food-img-large">
              </div>

              <div class="item-center">
                <div class="item-name">
                  {{ item.name }}
                </div>

                <div class="item-meta">
                  <span>{{ item.sold }} sold</span>

                  <span class="category-tag">
                    {{ item.category }}
                  </span>
                </div>
              </div>

              <div class="item-right">
                <div class="revenue-label">Revenue</div>
                <div class="price-text-big">
                  {{ item.revenue }}
                </div>
              </div>

            </div>

          </div>

        </mat-card-content>

      </mat-card>

      <!-- Category Chart -->
      <mat-card>

        <mat-card-header>
          <mat-card-title>
            <mat-icon>pie_chart</mat-icon>
            Items by Category
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>

          <div class="category-chart">

            <div class="category-bar"
                 *ngFor="let c of filteredCategories">

              <div class="bar-header">
                <span>{{ c.name }}</span>
                <span>{{ c.percent }}%</span>
              </div>

              <div class="chart-track">
                <div class="chart-fill"
                     [style.width.%]="c.percent"
                     [style.background]="c.color">
                </div>
              </div>

            </div>

          </div>

        </mat-card-content>

      </mat-card>

    </div>

        <!-- RECENT ORDERS + CRITICAL ALERTS GRID -->
<div class="orders-alerts-grid">

  <!-- LEFT: RECENT ORDERS -->
  <mat-card>

    <mat-card-header>
      <mat-card-title>
        <mat-icon>history</mat-icon>
        Recent Orders
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>

      <div *ngIf="recentOrders.length === 0" class="empty-state">
        No recent orders found
      </div>

      <mat-list *ngIf="recentOrders.length > 0">

        <mat-list-item *ngFor="let o of recentOrders">

          <mat-icon matListAvatar>receipt_long</mat-icon>

          <div mat-line>
            Order #{{ o.id }}
          </div>

          <div mat-line class="sub-text">
            {{ o.items }} items â€¢ â‚¹{{ o.amount }}
          </div>

          <span class="spacer"></span>

          <div class="order-status {{ o.status.toLowerCase() }}">
            {{ o.status }}
          </div>

        </mat-list-item>

      </mat-list>

    </mat-card-content>

  </mat-card>


  <!-- RIGHT: CRITICAL ALERTS -->
  <mat-card class="critical-alert-card">

    <mat-card-header>
      <mat-card-title>
        <mat-icon color="warn">notification_important</mat-icon>
        Critical Alerts
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>

      <div *ngIf="alerts.length === 0" class="empty-state-small">
        <mat-icon>check_circle</mat-icon>
        <p>No critical issues</p>
      </div>

      <div class="critical-alert-list" *ngIf="alerts.length > 0">

        <div *ngFor="let a of alerts"
             class="critical-alert-item"
             [ngClass]="a.type">

          <mat-icon>
            {{ a.type === 'error' ? 'error' : 'warning' }}
          </mat-icon>

          <span>{{ a.message }}</span>

        </div>

      </div>

    </mat-card-content>

  </mat-card>

</div>



    <!-- ===== END RECENT ORDERS ===== -->

    <!-- ACTIVITY LOG -->
    <mat-card class="mt-15">

      <mat-card-header>
        <mat-card-title>
          <mat-icon>list</mat-icon>
          Recent Activity
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>

        <mat-list>
          <mat-list-item *ngFor="let a of recentActivity">
            {{ a.text }} - {{ a.time }}
          </mat-list-item>
        </mat-list>

      </mat-card-content>

    </mat-card>

    <div *ngIf="loading" class="loading-overlay">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>

    <div class="footer">
      Tech2Copyright Â© 2026
    </div>

  </div>

</div>
