<div class="login-wrapper">

  <!-- ══ Animated Background Orbs ══ -->
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>

  <!-- ══ Left Brand Panel ══ -->
  <div class="login-brand">
    <div class="brand-content">

       <!-- ✅ UPDATED: Logo image replaces material icon -->
      <div class="brand-logo">
        <img
          src="assets\images\IconKitchenBook.png"
          alt="Kitchen Book - Cloud Kitchen ERP"
          class="kb-logo"
          width="96"
          height="96"
          style="border-radius: 24px; object-fit: contain;"
        />
      </div>
      <!-- Brand name rendered in CSS — white text on dark panel -->
        <h1 class="brand-title">Kitchen <span>Book</span></h1>
        <p class="brand-subtitle">— CLOUD KITCHEN ERP —</p>
        
      <div class="brand-features">
        <div class="feature-item">
          <span class="material-icons">check_circle</span>
          <span>Real-time kitchen display &amp; orders</span>
        </div>
        <div class="feature-item">
          <span class="material-icons">check_circle</span>
          <span>Multi-outlet POS &amp; billing</span>
        </div>
        <div class="feature-item">
          <span class="material-icons">check_circle</span>
          <span>Role-based access control</span>
        </div>
        <div class="feature-item">
          <span class="material-icons">check_circle</span>
          <span>Inventory &amp; recipe management</span>
        </div>
      </div>

      
      <ng-container *ngIf="showDevPanel">
        <!-- <div class="brand-roles-scroller">
          <div class="roles-track">
            <span class="role-badge"
                  *ngFor="let r of devRoles"
                  (click)="fillRole(r.username)">
              <span class="material-icons">{{ r.icon }}</span>
              {{ r.label }}
            </span>
            <span class="role-badge"
                  *ngFor="let r of devRoles"
                  (click)="fillRole(r.username)"
                  aria-hidden="true">
              <span class="material-icons">{{ r.icon }}</span>
              {{ r.label }}
            </span>
          </div>
        </div> -->
        <p class="brand-hint">⚡ Dev mode — click role to quick-fill</p>
      </ng-container>

    </div>
  </div>

  <!-- ══ Right Form Panel ══ -->
  <div class="login-form-panel">
    <div class="login-card">

      <!-- ── Header ── -->
      <div class="login-header">
        <div class="login-logo-sm">
          <img
            src="assets\images\Kitchen-book.logo.png"
            alt="Kitchen Book"
            class="kb-logo-sm"
          />
        </div>
        <h2>Welcome back</h2>
        <p>Sign in to your KB account</p>
      </div>

      <!-- ── Error Banner ── -->
      <div class="error-banner" *ngIf="errorMessage" role="alert">
        <span class="material-icons">error_outline</span>
        <span>{{ errorMessage }}</span>
      </div>

      <!-- ── Tab Switcher ── -->
      <div class="tab-switcher">
        <button type="button"
                [class.active]="activeTab === 'password'"
                (click)="setTab('password')">
          <span class="material-icons">lock</span>
          <span>Password</span>
        </button>
        <button type="button"
                [class.active]="activeTab === 'mobile'"
                (click)="setTab('mobile')">
          <span class="material-icons">smartphone</span>
          <span>Mobile OTP</span>
        </button>
      </div>

      <!-- ══ Password Tab ══ -->
      <form *ngIf="activeTab === 'password'"
            (ngSubmit)="onPasswordSubmit()" novalidate
            class="login-form">

        <!-- Username -->
        <div class="form-group">
          <label for="username">Username</label>
          <div class="input-wrapper">
            <span class="material-icons input-icon">person</span>
            <input id="username"
                   type="text"
                   [(ngModel)]="username"
                   name="username"
                   placeholder="Enter your username"
                   autocomplete="username"
                   [disabled]="isLoading" />
          </div>
        </div>

        <!-- Password -->
        <div class="form-group">
          <div class="label-row">
            <label for="password">Password</label>
            <a class="forgot-link" routerLink="/forgot-password">Forgot password?</a>
          </div>
          <div class="input-wrapper">
            <span class="material-icons input-icon">lock</span>
            <input id="password"
                   [type]="showPassword ? 'text' : 'password'"
                   [(ngModel)]="password"
                   name="password"
                   placeholder="Enter your password"
                   autocomplete="current-password"
                   [disabled]="isLoading" />
            <span class="material-icons toggle-eye"
                  (click)="togglePassword()"
                  [title]="showPassword ? 'Hide password' : 'Show password'">
              {{ showPassword ? 'visibility_off' : 'visibility' }}
            </span>
          </div>
        </div>

        <!-- ── Role Dropdown ── -->
        <div class="form-group">
          <label for="role">Role</label>
          <div class="select-wrapper" [class.has-value]="selectedRole">
            <span class="material-icons input-icon">badge</span>
            <select id="role"
                    [(ngModel)]="selectedRole"
                    name="selectedRole"
                    [disabled]="isLoading">
              <option value="" disabled hidden>Select your role</option>
              <option *ngFor="let r of roles" [value]="r.value">
                {{ r.label }}
              </option>
            </select>
            <span class="material-icons select-chevron">expand_more</span>
          </div>
        </div>

        <button type="submit" class="btn-login" [disabled]="isLoading">
          <span class="material-icons spin" *ngIf="isLoading">autorenew</span>
          <span>{{ isLoading ? 'Signing in...' : 'Sign In' }}</span>
          <span class="material-icons" *ngIf="!isLoading">arrow_forward</span>
        </button>

      </form>

      <!-- ══ Mobile OTP Tab ══ -->
      <form *ngIf="activeTab === 'mobile'"
            (ngSubmit)="onOtpSubmit()" novalidate
            class="login-form">

        <div class="form-group">
          <label for="mobile">Mobile Number</label>
          <div class="input-wrapper">
            <span class="material-icons input-icon">smartphone</span>
            <input id="mobile"
                   type="tel"
                   [(ngModel)]="mobile"
                   name="mobile"
                   placeholder="10-digit mobile number"
                   maxlength="10"
                   [disabled]="isLoading" />
            <button type="button"
                    class="btn-otp"
                    (click)="sendOtp()"
                    [disabled]="otpTimer > 0 || isLoading">
              <span class="material-icons" *ngIf="otpTimer === 0" style="font-size:14px">send</span>
              {{ otpTimer > 0 ? otpTimer + 's' : (otpSent ? 'Resend' : 'Send OTP') }}
            </button>
          </div>
        </div>

        <div class="form-group otp-field" *ngIf="otpSent">
          <label for="otp">
            Enter OTP
            <span class="otp-hint">Sent to +91 {{ mobile }}</span>
          </label>
          <div class="input-wrapper">
            <span class="material-icons input-icon">pin</span>
            <input id="otp"
                   type="text"
                   [(ngModel)]="otp"
                   name="otp"
                   placeholder="Enter 4–6 digit OTP"
                   maxlength="6"
                   inputmode="numeric"
                   [disabled]="isLoading" />
          </div>
        </div>

        <button type="submit"
                class="btn-login"
                [disabled]="isLoading || !otpSent">
          <span class="material-icons spin" *ngIf="isLoading">autorenew</span>
          <span>{{ isLoading ? 'Verifying...' : 'Verify & Sign In' }}</span>
          <span class="material-icons" *ngIf="!isLoading">arrow_forward</span>
        </button>

      </form>

      <!-- ── Divider ── -->
      <div class="divider"><span>or continue with</span></div>

      <!-- ── Social Buttons ── -->
      <div class="social-buttons">
        <button class="btn-social btn-google"
                type="button"
                (click)="loginWithGoogle()"
                [disabled]="isLoading">
          <img src="assets/icons/google.svg" alt=""
               onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" />
          <span class="social-fallback" style="display:none">G</span>
          <span>Google</span>
        </button>
        <button class="btn-social btn-zoho"
                type="button"
                (click)="loginWithZoho()"
                [disabled]="isLoading">
          <img src="assets/icons/zoho.svg" alt=""
               onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" />
          <span class="social-fallback" style="display:none">Z</span>
          <span>Zoho Mail</span>
        </button>
      </div>

      <!-- ── Footer ── -->
      <div class="login-footer">
        <p class="login-hint">
          First time? You'll be registered as <strong>Owner</strong>
        </p>
        <p class="signup-redirect">
          New to Kitchen Book? <a routerLink="/signup">Create account</a>
        </p>
      </div>

    </div>
  </div>
</div>
