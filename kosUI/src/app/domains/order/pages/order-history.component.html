<div class="order-history">

  <!-- ================= HEADER ================= -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">ğŸ“‹ Order History</h1>
      <div class="header-actions">
        <button class="btn btn-export" (click)="exportToCSV()">
          ğŸ“Š Export CSV
        </button>
      </div>
    </div>
  </div>

  <!-- ================= FILTERS & SEARCH ================= -->
  <div class="filters-section">
    
    <!-- Search Bar -->
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="ğŸ” Search by order number, customer, table..."
        [(ngModel)]="searchText"
        (input)="applyFilters()">
    </div>

    <!-- Filter Row -->
    <div class="filter-row">
      
      <!-- Date Range -->
      <div class="filter-group">
        <label class="filter-label">Date Range:</label>
        <select class="filter-select" [(ngModel)]="selectedDateRange" (change)="applyDateFilter()">
          <option value="all">All Time</option>
          <option value="today">Today</option>
          <option value="yesterday">Yesterday</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="custom">Custom</option>
        </select>
      </div>

      <!-- Custom Date Inputs -->
      <div class="filter-group" *ngIf="selectedDateRange === 'custom'">
        <input
          type="date"
          class="filter-input"
          [(ngModel)]="customDateRange.start"
          (change)="applyFilters()">
        <span class="date-separator">to</span>
        <input
          type="date"
          class="filter-input"
          [(ngModel)]="customDateRange.end"
          (change)="applyFilters()">
      </div>

      <!-- Status Filter -->
      <div class="filter-group">
        <label class="filter-label">Status:</label>
        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="all">All Statuses</option>
          <option [value]="OrderStatus.PENDING">Pending</option>
          <option [value]="OrderStatus.PREPARING">Preparing</option>
          <option [value]="OrderStatus.READY">Ready</option>
          <option [value]="OrderStatus.SERVED">Served</option>
          <option [value]="OrderStatus.CANCELLED">Cancelled</option>
        </select>
      </div>

      <!-- Order Type Filter -->
      <div class="filter-group">
        <label class="filter-label">Type:</label>
        <select class="filter-select" [(ngModel)]="selectedType" (change)="applyFilters()">
          <option value="all">All Types</option>
          <option [value]="OrderType.DINE_IN">Dine-In</option>
          <option [value]="OrderType.TAKEAWAY">Takeaway</option>
          <option [value]="OrderType.DELIVERY">Delivery</option>
        </select>
      </div>

      <!-- Sort By -->
      <div class="filter-group">
        <label class="filter-label">Sort By:</label>
        <select class="filter-select" [(ngModel)]="sortBy" (change)="applySorting()">
          <option value="date-desc">Date (Newest)</option>
          <option value="date-asc">Date (Oldest)</option>
          <option value="amount-desc">Amount (High to Low)</option>
          <option value="amount-asc">Amount (Low to High)</option>
          <option value="order-number">Order Number</option>
        </select>
      </div>

    </div>

  </div>

  <!-- ================= STATS CARDS ================= -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“¦</div>
      <div class="stat-content">
        <div class="stat-label">Total Orders</div>
        <div class="stat-value">{{ stats.totalOrders }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <div class="stat-label">Total Revenue</div>
        <div class="stat-value">â‚¹{{ stats.totalRevenue | number:'1.0-0' }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-label">Average Order</div>
        <div class="stat-value">â‚¹{{ stats.avgOrderValue | number:'1.0-0' }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-label">Completed</div>
        <div class="stat-value">{{ stats.completedOrders }}</div>
      </div>
    </div>
  </div>

  <!-- ================= ORDERS TABLE ================= -->
  <div class="table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>Order #</th>
          <th>Date & Time</th>
          <th>Table/Customer</th>
          <th>Type</th>
          <th>Items</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Waiter</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of paginatedOrders; trackBy: trackById" 
            class="table-row">
          
          <td class="order-number">{{ order.orderNumber }}</td>
          
          <td class="order-date">
            <div>{{ order.orderTime | date:'dd MMM yyyy' }}</div>
            <div class="time-text">{{ order.orderTime | date:'hh:mm a' }}</div>
          </td>
          
          <td>
            <div class="customer-info">
              <strong *ngIf="order.tableName">{{ order.tableName }}</strong>
              <span>{{ order.customerName || 'Guest' }}</span>
            </div>
          </td>
          
          <td>
            <span class="order-type-badge" [class]="'type-' + order.type.toLowerCase()">
              {{ order.type === OrderType.DINE_IN ? 'ğŸ½ï¸' : order.type === OrderType.TAKEAWAY ? 'ğŸ¥¡' : 'ğŸ›µ' }}
              {{ order.type.replace('_', ' ') }}
            </span>
          </td>
          
          <td class="items-cell">
            <div class="items-count" [title]="getItemsTooltip(order)">
              {{ order.items.length }} item(s)
            </div>
          </td>
          
          <td class="amount-cell">
            <strong>â‚¹{{ order.totalAmount | number:'1.0-0' }}</strong>
          </td>
          
          <td>
            <span class="status-badge" [class]="'status-' + order.status.toLowerCase()">
              {{ order.status }}
            </span>
          </td>
          
          <td>{{ order.waiterName || '-' }}</td>
          
          <td class="actions-cell">
            <button class="btn-icon" (click)="viewOrderDetails(order)" title="View Details">
              ğŸ‘ï¸
            </button>
            <button class="btn-icon" (click)="printReceipt(order)" title="Print Receipt">
              ğŸ–¨ï¸
            </button>
          </td>
        </tr>

        <tr *ngIf="paginatedOrders.length === 0">
          <td colspan="9" class="empty-row">
            <div class="empty-state">
              <span class="empty-icon">ğŸ“­</span>
              <p>No orders found</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ================= PAGINATION ================= -->
  <div class="pagination" *ngIf="filteredOrders.length > 0">
    <div class="pagination-info">
      Showing {{ startIndex + 1 }} to {{ endIndex }} of {{ filteredOrders.length }} orders
    </div>

    <div class="pagination-controls">
      <button 
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="goToPage(1)">
        â®ï¸
      </button>

      <button 
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="previousPage()">
        â—€ï¸
      </button>

      <span class="page-numbers">
        <button
          *ngFor="let page of getPageNumbers()"
          class="page-btn"
          [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      </span>

      <button 
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="nextPage()">
        â–¶ï¸
      </button>

      <button 
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="goToPage(totalPages)">
        â­ï¸
      </button>
    </div>

    <div class="page-size-selector">
      <label>Show:</label>
      <select [(ngModel)]="pageSize" (change)="changePageSize()">
        <option [value]="10">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
        <option [value]="100">100</option>
      </select>
    </div>
  </div>

</div>
