<div class="cashier-container" [class.loading]="loading">

  <!-- ===== BODY ROW: Left Column + Right Sidebar ===== -->
  <div class="body-row">

    <!-- ── LEFT COLUMN: Shortcuts Bar + Menu Panel ── -->
    <div class="left-column">

      <!-- Shortcuts Bar sits INSIDE left column only -->
      <div class="shortcuts-bar">

        <button
          class="header-icon-btn"
          [matMenuTriggerFor]="quickMenu"
          type="button">
          <mat-icon>menu</mat-icon>
        </button>

        <mat-menu #quickMenu="matMenu">
          <button mat-menu-item (click)="refreshData()">
            <mat-icon>refresh</mat-icon>
            <span>Refresh (F5)</span>
          </button>
          <button mat-menu-item (click)="showHeldOrders()">
            <mat-icon>pending_actions</mat-icon>
            <span>View Held Orders</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="clearCart()" [disabled]="!hasItems">
            <mat-icon>delete_sweep</mat-icon>
            <span>Clear Cart (Ctrl+Del)</span>
          </button>
          <button mat-menu-item (click)="resetOrder()">
            <mat-icon>restart_alt</mat-icon>
            <span>New Order (Ctrl+N)</span>
          </button>
        </mat-menu>

        <div class="shortcut-hint"><kbd>F2</kbd> Hold</div>
        <div class="shortcut-hint"><kbd>F3</kbd> Payment</div>
        <div class="shortcut-hint"><kbd>F4</kbd> KOT</div>
        <div class="shortcut-hint"><kbd>Ctrl+N</kbd> New Order</div>
        <div class="shortcut-hint"><kbd>Esc</kbd> Close Popups</div>

      </div>

      <!-- Menu Panel fills remaining left column height -->
      <section class="center-panel">
        <app-menu-area (itemAdd)="onItemAdd($event)">
        </app-menu-area>
      </section>

    </div>

    <!-- ── RIGHT COLUMN: Sidebar full height (top to bottom) ── -->
    <aside class="sidebar-panel">

      <app-order-sidebar
        [orderType]="orderType"
        [selectedTable]="selectedTable"
        [cartItemCount]="itemCount"
        (orderTypeChange)="onOrderTypeChange($event)"
        (tableSelect)="onTableSelected($event)">
      </app-order-sidebar>

      <app-cart-panel
        [cart]="cart"
        [subtotal]="subtotal"
        [tax]="tax"
        [discount]="discount"
        [total]="total"
        [orderType]="orderType"
        [tableNumber]="selectedTable"
        (cartUpdate)="onCartUpdate($event)"
        (itemRemove)="onItemRemove($event)"
        (checkout)="openPayment()">
      </app-cart-panel>

    </aside>

  </div>

  <!-- ===== BOTTOM ACTION BAR ===== -->
  <footer class="bottom-bar">

    <div class="left-actions">
      <button
        class="action-btn btn-secondary"
        (click)="printKOT()"
        [disabled]="!hasItems"
        matTooltip="Print Kitchen Order (F4)"
        matTooltipPosition="above"
        type="button">
        <mat-icon>print</mat-icon>
        <span>Print KOT</span>
      </button>

      <button
        class="action-btn btn-secondary"
        (click)="saveOrder()"
        [disabled]="!hasItems"
        matTooltip="Save Order (Ctrl+S)"
        matTooltipPosition="above"
        type="button">
        <mat-icon>save</mat-icon>
        <span>Save Order</span>
      </button>

      <button
        class="action-btn btn-warning"
        (click)="holdOrder()"
        [disabled]="!hasItems"
        matTooltip="Hold Order (F2)"
        matTooltipPosition="above"
        type="button">
        <mat-icon>pause_circle</mat-icon>
        <span>Hold Order</span>
      </button>

      <button
        class="action-btn btn-info"
        (click)="showHeldOrders()"
        matTooltip="View Held Orders"
        matTooltipPosition="above"
        type="button">
        <mat-icon>pending_actions</mat-icon>
        <span>Held Orders</span>
      </button>
    </div>

    <div class="center-status">
      <div class="order-summary" *ngIf="hasItems">
        <div class="summary-line">
          <span class="summary-label">Items:</span>
          <span class="summary-value">{{ itemCount }}</span>
        </div>
        <div class="summary-divider">|</div>
        <div class="summary-line">
          <span class="summary-label">Subtotal:</span>
          <span class="summary-value">₹{{ subtotal | number:'1.0-0' }}</span>
        </div>
      </div>
      <div class="empty-state-text" *ngIf="!hasItems">
        Cart is empty — Start adding items
      </div>
    </div>

    <div class="right-actions">
      <button
        class="action-btn btn-danger"
        (click)="closeTable()"
        [disabled]="!selectedTable"
        matTooltip="Close Current Table"
        matTooltipPosition="above"
        type="button">
        <mat-icon>close</mat-icon>
        <span>Close Table</span>
      </button>

      <button
        class="action-btn btn-primary pay-btn"
        [disabled]="!hasItems"
        (click)="openPayment()"
        matTooltip="Proceed to Payment (F3)"
        matTooltipPosition="above"
        type="button">
        <mat-icon>payments</mat-icon>
        <span>Pay Now</span>
        <span class="amount">₹{{ total | number:'1.0-0' }}</span>
        <mat-icon class="arrow">arrow_forward</mat-icon>
      </button>
    </div>

  </footer>

</div>

<!-- ===== NOTIFICATIONS PANEL ===== -->
<div class="notifications-panel"
  *ngIf="showNotifications && notifications.length > 0">
  <div class="notifications-header">
    <h3>Notifications</h3>
    <button class="close-btn" (click)="showNotifications = false" type="button">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="notifications-list">
    <div
      class="notification-item"
      *ngFor="let notif of notifications; trackBy: trackByNotificationId"
      [ngClass]="'notification-' + notif.type">
      <mat-icon class="notif-icon">{{ getNotificationIcon(notif.type) }}</mat-icon>
      <span class="notif-message">{{ notif.message }}</span>
      <button
        class="notif-close"
        (click)="dismissNotification(notif.id)"
        type="button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
</div>

<!-- ===== TOAST NOTIFICATIONS ===== -->
<div class="toast-container">
  <div
    class="toast-notification"
    *ngFor="let notif of notifications.slice(-3); trackBy: trackByNotificationId"
    [ngClass]="'toast-' + notif.type">
    <mat-icon class="toast-icon">{{ getNotificationIcon(notif.type) }}</mat-icon>
    <span class="toast-message">{{ notif.message }}</span>
    <button
      class="toast-close"
      (click)="dismissNotification(notif.id)"
      type="button">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>

<!-- ===== PAYMENT POPUP ===== -->
<app-payment-popup
  *ngIf="showPayment"
  [total]="total"
  [subtotal]="subtotal"
  [tax]="tax"
  [discount]="discount"
  [cart]="cart"
  [orderType]="orderType"
  [tableNumber]="selectedTable"
  [customerInfo]="customerInfo"
  [orderNumber]="orderNumber"
  (close)="onPaymentCancel()"
  (complete)="onPaymentComplete($event)">
</app-payment-popup>

<!-- ===== HELD ORDERS POPUP ===== -->
<app-hold-orders
  *ngIf="showHoldOrders"
  (recallOrder)="recallOrder($event)"
  (close)="showHoldOrders = false">
</app-hold-orders>

<!-- ===== CUSTOMER INFO DIALOG ===== -->
<div class="customer-info-overlay" *ngIf="showCustomerInfo">
  <div class="customer-info-modal">
    <div class="modal-header">
      <h3>Customer Information</h3>
      <button
        class="close-btn"
        (click)="showCustomerInfo = false"
        type="button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <form
      class="customer-form"
      #customerForm="ngForm"
      (ngSubmit)="onCustomerInfoSubmit(customerForm.value)">
      <div class="form-group">
        <label>Customer Name *</label>
        <input
          type="text"
          name="name"
          ngModel
          required
          placeholder="Enter customer name"
          class="form-control">
      </div>
      <div class="form-group">
        <label>Phone Number *</label>
        <input
          type="tel"
          name="phone"
          ngModel
          required
          pattern="[0-9]{10}"
          placeholder="10-digit mobile number"
          class="form-control">
      </div>
      <div class="form-group" *ngIf="orderType === 'Delivery'">
        <label>Delivery Address *</label>
        <textarea
          name="address"
          ngModel
          required
          rows="3"
          placeholder="Enter complete delivery address"
          class="form-control"></textarea>
      </div>
      <div class="form-group">
        <label>Email (Optional)</label>
        <input
          type="email"
          name="email"
          ngModel
          placeholder="customer@example.com"
          class="form-control">
      </div>
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="showCustomerInfo = false">
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!customerForm.valid">
          Continue to Payment
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ===== LOADING OVERLAY ===== -->
<div class="loading-overlay" *ngIf="loading">
  <div class="loading-spinner">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading...</p>
  </div>
</div>

<!-- ===== ERROR BANNER ===== -->
<div class="error-banner" *ngIf="error">
  <mat-icon>error</mat-icon>
  <span>{{ error }}</span>
  <button (click)="error = null" type="button">
    <mat-icon>close</mat-icon>
  </button>
</div>
