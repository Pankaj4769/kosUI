<div class="menu-area">

  <!-- ================= HEADER ================= -->
  <div class="menu-header">

    <!-- Row 1: Search + View Toggle + Refresh + Sort + Tags inline -->
    <div class="header-row">

      <!-- Tag Filters inline -->
      <div class="tag-filters">
        <button
          *ngFor="let tag of availableTags"
          class="tag-chip"
          [class.active]="isTagSelected(tag)"
          (click)="toggleTag(tag)"
          type="button">
          {{ tag }}
        </button>
      </div>

      <!-- Search Box -->
      <div class="search-box">
        <mat-icon>search</mat-icon>
        <input
          type="text"
          class="search-input"
          placeholder="Search menu items..."
          [(ngModel)]="searchQuery"
          (input)="onSearchChange(searchQuery)">
        <button
          class="clear-search-btn"
          *ngIf="searchQuery"
          (click)="clearSearch()"
          type="button">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <!-- View Toggle -->
      <div class="view-toggle">
        <button
          class="view-btn"
          [class.active]="viewMode === 'grid'"
          (click)="setViewMode('grid')"
          matTooltip="Grid View"
          type="button">
          <mat-icon>grid_view</mat-icon>
        </button>
        <button
          class="view-btn"
          [class.active]="viewMode === 'list'"
          (click)="setViewMode('list')"
          matTooltip="List View"
          type="button">
          <mat-icon>view_list</mat-icon>
        </button>
      </div>

      <!-- Refresh -->
      <button
        class="icon-btn"
        (click)="refreshMenu()"
        matTooltip="Refresh Menu"
        type="button">
        <mat-icon>refresh</mat-icon>
      </button>

      <!-- Sort -->
      <button class="sort-btn" [matMenuTriggerFor]="sortMenu" type="button">
        <mat-icon>sort</mat-icon>
        <span>Sort: {{ sortBy }}</span>
        <mat-icon class="chevron">expand_more</mat-icon>
      </button>

      <mat-menu #sortMenu="matMenu">
        <button mat-menu-item (click)="changeSortBy('name')">
          <mat-icon>sort_by_alpha</mat-icon>
          <span>Name</span>
        </button>
        <button mat-menu-item (click)="changeSortBy('price')">
          <mat-icon>currency_rupee</mat-icon>
          <span>Price</span>
        </button>
        <button mat-menu-item (click)="changeSortBy('popular')">
          <mat-icon>star</mat-icon>
          <span>Popular</span>
        </button>
      </mat-menu>

      <!-- Clear Filters -->
      <button
        class="clear-filters-btn"
        *ngIf="selectedTags.length > 0 || searchQuery"
        (click)="clearAllFilters()"
        type="button">
        <mat-icon>clear_all</mat-icon>
      </button>

    </div>

    <!-- Row 2: Category Tabs only -->
    <div class="category-tabs">
      <button
        *ngFor="let category of categories; trackBy: trackByCategoryId"
        class="category-tab"
        [class.active]="selectedCategory === category.id"
        (click)="selectCategory(category.name)"
        type="button">
        <mat-icon>{{ category.icon }}</mat-icon>
        <span class="category-name">{{ category.name }}</span>
        <span class="category-count">{{ category.itemCount }}</span>
      </button>
    </div>

  </div>

  <!-- ================= MENU ITEMS ================= -->
  <div class="menu-content" *ngIf="!loading && !error">

    <!-- Grid View -->
    <div
      class="menu-grid"
      *ngIf="viewMode === 'grid' && filteredItems.length > 0">

      <div
        class="menu-card"
        *ngFor="let item of filteredItems">

        <div class="card-image">
          <img
            [src]="'assets/images/image.png'"
            [alt]="item.name">
          <div class="image-placeholder" *ngIf="!item.image">
            <mat-icon>restaurant</mat-icon>
          </div>
          <div class="badges-overlay">
            <span
              *ngFor="let badge of getItemBadges(item)"
              class="item-badge"
              [ngClass]="'badge-' + badge.toLowerCase()">
              <mat-icon>{{ getBadgeIcon(badge) }}</mat-icon>
              {{ badge }}
            </span>
          </div>
        </div>

        <div class="card-content">
          <h3 class="item-name">{{ item.name }}</h3>
          <p class="item-description">This is dummy description</p>

          <div class="card-footer">
            <div class="price-section">
              <span class="currency">₹</span>
              <span class="price">{{ item.price }}</span>
            </div>

            <div class="add-actions" *ngIf="!item.addedToCartStatus">
              <button
                class="add-btn"
                (click)="quickAddItem(item)"
                matTooltip="Add to cart"
                type="button">
                <mat-icon>add_shopping_cart</mat-icon>
              </button>
            </div>

            <div class="quantity-controls" *ngIf="item.addedToCartStatus">
              <button
                class="qty-btn"
                (click)="decrementQuantity(item)"
                type="button">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="qty-value">{{ item.qty }}</span>
              <button
                class="qty-btn"
                (click)="incrementQuantity(item)"
                type="button">
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- List View -->
    <div
      class="menu-list"
      *ngIf="viewMode === 'list' && filteredItems.length > 0">

      <div
        class="list-item"
        *ngFor="let item of filteredItems">

        <div class="list-item-content">
          <div class="item-info">
            <h3 class="item-name">
              {{ item.name }}
              <span
                *ngFor="let badge of getItemBadges(item)"
                class="inline-badge"
                [ngClass]="'badge-' + badge.toLowerCase()">
                {{ badge }}
              </span>
            </h3>
            <span class="item-category">{{ item.category }}</span>
          </div>

          <div class="list-item-actions">
            <div class="price-large">₹{{ item.price }}</div>
            <button
              class="add-btn-large"
              (click)="quickAddItem(item)"
              type="button">
              <mat-icon>add_shopping_cart</mat-icon>
              Add
            </button>
          </div>
        </div>

      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredItems.length === 0">
      <mat-icon>search_off</mat-icon>
      <h3>No items found</h3>
      <p>Try adjusting your search or filters</p>
      <button class="clear-btn" (click)="clearAllFilters()" type="button">
        Clear All Filters
      </button>
    </div>

  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading menu...</p>
  </div>

  <!-- Error -->
  <div class="error-state" *ngIf="error">
    <mat-icon>error_outline</mat-icon>
    <h3>Failed to load menu</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="refreshMenu()" type="button">
      <mat-icon>refresh</mat-icon>
      Retry
    </button>
  </div>

</div>
